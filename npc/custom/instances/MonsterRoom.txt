

prontera,165,188,3	script	Monster Room Manager::mobmgr	734,{
	mes "[Monster Room Manager]";
	mes "Good morning!";
	next;
	switch(select("Start Instance:Enter Monster Room:Nothing")) {
	case 1:
		set .@party,getcharid(1);  // party id
		set .@leader,getpartyleader(.@party,2);  
		set .@md_name$,"Monster Room";

		getpartymember(.@party);  // fills up global $@partymembername$[]
		set .@partymembercount,$@partymembercount;
		copyarray .@partymembername$[0],$@partymembername$[0],.@partymembercount;

		// the leader must start the instance
		if ((.@party > 0) && (.@leader == getcharid(0))) {
			set .@instance, instance_create(.@md_name$, .@party);
			if (.@instance < 0) {
				mes "[Monster Room Manager]";
				mes "You cannot create an instance of the Monster Room.";
				mes "An instance may have already been created.";
				close;
			}
			else {
				if (instance_attachmap("2@nyd", .@instance) == "") {
					instance_destroy(.@instance);
					close;
				}
				
				instance_attach(.@instance);  // attaches the current script to the instance
				instance_set_timeout 3600,300,.@instance;  // 1 hour limit, 5 min idle timeout
				instance_init(.@instance);  // initialize instance, copy all NPCs from source maps to instance

				// Disable default NPCs
				
				// Spawn standard mobs
				//disablenpc instance_npcname("ins_nyd1_spawn_mobs", instance_id());
				disablenpc instance_npcname("ins_nyd2_spawn_mobs", instance_id());
				// Activate Floor 1
				//disablenpc instance_npcname("nyd_call_mon_1", instance_id());
				//disablenpc instance_npcname("ins_nyd_1f_timer", instance_id());
				//disablenpc instance_npcname("nyd_to2f_warp", instance_id());
				// Active Floor 2
				disablenpc instance_npcname("nyd_2f_enter_broad", instance_id());
				disablenpc instance_npcname("nyd_2f_boss_enter", instance_id());
				disablenpc instance_npcname("nyd_2f_boss_enter_call", instance_id());
				disablenpc instance_npcname("nyd_2f_boss_enter_logic", instance_id());
				disablenpc instance_npcname("World Tree Yggdrasil#2F", instance_id());
				disablenpc instance_npcname("nyd_2f_red", instance_id());
				disablenpc instance_npcname("nyd_2f_red_c", instance_id());
				disablenpc instance_npcname("nyd_2f_red_warp1", instance_id());
				disablenpc instance_npcname("nyd_2f_red_warp2", instance_id());
				disablenpc instance_npcname("nyd_2f_red_warp3", instance_id());
				disablenpc instance_npcname("nyd_2f_white", instance_id());
				disablenpc instance_npcname("nyd_2f_white_c", instance_id());
				disablenpc instance_npcname("nyd_2f_white_warp1", instance_id());;
				disablenpc instance_npcname("nyd_2f_white_warp2", instance_id());;
				disablenpc instance_npcname("nyd_2f_white_warp3", instance_id());;
				disablenpc instance_npcname("nyd_2f_yellow", instance_id());
				disablenpc instance_npcname("nyd_2f_yellow_c", instance_id());
				disablenpc instance_npcname("nyd_2f_yellow_warp1", instance_id());
				disablenpc instance_npcname("nyd_2f_yellow_warp2", instance_id());
				disablenpc instance_npcname("nyd_2f_yellow_warp3", instance_id());
				disablenpc instance_npcname("nyd_2f_green", instance_id());
				disablenpc instance_npcname("nyd_2f_green_c", instance_id());
				disablenpc instance_npcname("nyd_2f_green_warp1", instance_id());
				disablenpc instance_npcname("nyd_2f_green_warp2", instance_id());
				disablenpc instance_npcname("nyd_2f_green_warp3", instance_id());
			}
			
			mes "You may now enter the monster room.";
			close;
		}
		else {
			mes "Only the party leader can create an instance.";
			close;
		}
	case 2:
		set .@party,getcharid(1);
		set .@leader,getpartyleader(.@party,2);
		set .@p_name$,getpartyname(.@party);
		set .@p_name2$,strcharinfo(0);
		set .@md_name$,"Monster Room";

		getpartymember(.@party);
		set .@partymembercount,$@partymembercount;
		copyarray .@partymembername$[0],$@partymembername$[0],.@partymembercount;
		
		if (has_instance("2@nyd") == "") {
			mes "[Monster Room Manager]";
			mes "You haven't started an instance yet!";
			close;
		}
		
		warp "2@nyd",156,330;
		close;
	case 3:
		close;
	}
	
}